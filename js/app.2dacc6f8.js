(function(t){function e(e){for(var r,i,s=e[0],c=e[1],l=e[2],h=0,f=[];h<s.length;h++)i=s[h],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&f.push(o[i][0]),o[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);u&&u(e);while(f.length)f.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(a.splice(e--,1),t=i(i.s=n[0]))}return t}var r={},o={app:0},a=[];function i(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=r,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/transcribe-frontend/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("AudioPlayer"),n("Waveform")],1)},a=[],i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"text-center"},[n("v-btn",{attrs:{icon:"",large:"",fab:"",color:"indigo"},on:{click:t.play}},[n("v-icon",[t._v("mdi-play-circle-outline")])],1),n("v-btn",{attrs:{icon:"",large:"",fab:"",color:"indigo"},on:{click:t.pause}},[n("v-icon",[t._v("mdi-pause-circle-outline")])],1),n("v-btn",{attrs:{icon:"",large:"",fab:"",color:"indigo"},on:{click:t.stop}},[n("v-icon",[t._v("mdi-stop-circle-outline")])],1),n("v-file-input",{attrs:{accept:"audio/*",label:"Select file (any audio format)"},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}}),n("v-btn",{attrs:{icon:"",large:"",fab:"",color:"indigo"},on:{click:t.upload}},[t._v("Go!")])],1)},s=[],c=n("1e5c"),l={data:function(){return{file:null}},methods:{play:function(){this.$store.dispatch("play")},pause:function(){this.$store.dispatch("pause")},stop:function(){this.$store.dispatch("stop")},upload:function(){var t=this.file,e=new FileReader,n=this.$store;e.addEventListener("load",(function(){var r=e.result,o=new c["Howl"]({src:r,html5:!0,autoplay:!1});n.dispatch("upload",{howl:o,file:t})})),e.readAsDataURL(t)}}},u=l,h=n("2877"),f=n("6544"),p=n.n(f),d=n("8336"),m=n("23a7"),v=n("132d"),g=Object(h["a"])(u,i,s,!1,null,null,null),b=g.exports;p()(g,{VBtn:d["a"],VFileInput:m["a"],VIcon:v["a"]});var k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{width:"100%"}},[n("canvas",{ref:"can",attrs:{id:"c"},on:{mousedown:t.startSelect,mouseup:t.endSelect,mousemove:t.selectMove}}),n("v-btn",{attrs:{icon:"",large:"",fab:"",color:"indigo"},on:{click:t.onZoomIn}},[n("v-icon",[t._v("mdi-magnify-plus")])],1),n("v-btn",{attrs:{icon:"",large:"",fab:"",color:"indigo"},on:{click:t.onZoomOut}},[n("v-icon",[t._v("mdi-magnify-minus")])],1),t._m(0)],1)},y=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{width:"100%",overflow:"scroll"},attrs:{id:"scrolltar"}},[n("canvas",{staticStyle:{resize:"both"},attrs:{id:"scroller"}})])}],w=(n("4160"),n("a9e3"),n("159b"),n("96cf"),n("1da1")),S=(n("dca8"),n("d3b7"),n("2f62")),x=(n("99af"),n("13d5"),n("fb6a"),n("90d7"),n("d4ec")),P=n("bee2"),O=n("b85c");function L(t){var e,n=0,r=0,o=Object(O["a"])(t);try{for(o.s();!(e=o.n()).done;){var a=e.value;r=Math.max(a,r),n=Math.min(a,n)}}catch(i){o.e(i)}finally{o.f()}return[r,n]}function A(t,e){return t.reduce(e)}function E(t){return A(t,(function(t,e){return t+e}))/t.length}function T(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[],o=Math.ceil(t.length/e),a=n;a<o*e;a+=e)r.push(E(t.slice(a,a+e)));return{avg:r}}var _=function(){function t(e){Object(x["a"])(this,t),this.data=e,this.tree=new Array(2*e.length-1),this.buildTree()}return Object(P["a"])(t,[{key:"buildTree",value:function(){for(var t=this.data,e=this.tree,n=t.length,r=0;r<n;r++)e[n-1+r]=[t[r],t[r]];for(var o=n-2;o>=0;o--)e[o]=L(e[2*o+1].concat(e[2*o+2]))}},{key:"segmentPeakBottom",value:function(t,e){t+=this.data.length-1,e+=this.data.length-1;var n=[],r=[];while(t<e)t%2==0&&(n=L(n.concat(this.tree[t]))),t>>=1,e%2&&(r=L(this.tree[e].concat(r))),e>>=1,e-=1;return t==e&&(n=L(this.tree[t].concat(n))),L(n.concat(r))}},{key:"segmentSize",value:function(t,e){var n=1+Math.log2(1+t),r=this.data.length;return Math.floor(r/e/n)}}]),t}();r["a"].use(S["a"]);var j=Object.freeze({PLAY:"play",PAUSE:"pause",STOP:"stop"}),$={play:function(t){switch(t.playback){case j.PLAY:return;case j.PAUSE:t.playback=j.PLAY;break;case j.STOP:t.playback=j.PLAY;break}},pause:function(t){switch(t.playback){case j.PLAY:t.playback=j.PAUSE;break;case j.PAUSE:break;case j.STOP:break}},stop:function(t){switch(t.playback){case j.PLAY:t.playback=j.STOP;break;case j.PAUSE:t.playback=j.STOP;break;case j.STOP:break}},peaks:function(t,e){t.peaks=e},segments:function(t,e){t.segments=e},buffer:function(t,e){t.buffer=e},loop:function(t,e){t.loop=e},howl:function(t,e){t.tracks.push(e)}},M={startLoop:function(t,e){console.log(e[0]+" "+e[1]),t.getters.track.stop(),t.dispatch("stop"),t.getters.track._sprite.l=[1e3*e[0],1e3*(e[1]-e[0]),!0],t.commit("loop",[!0,e[0],e[1]]),t.dispatch("play")},endLoop:function(t){t.commit("loop",[!1,null,null])},play:function(t){t.state.loop[0]?t.getters.track.play("l"):(t.getters.track.pause(),t.getters.track.play()),t.commit("play")},pause:function(t){t.getters.track.pause(),t.commit("pause")},stop:function(t){t.getters.track.stop(),t.commit("stop")},upload:function(t,e){return Object(w["a"])(regeneratorRuntime.mark((function n(){var r,o,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.file.arrayBuffer().then((function(t){return c["Howler"].ctx.decodeAudioData(t)}));case 2:r=n.sent,o=[r.getChannelData(0),r.getChannelData(1)],a=new _(T(o[0],100)["avg"]),t.dispatch("stop"),t.dispatch("newTrack",e.howl),t.dispatch("endLoop"),t.commit("buffer",r),t.commit("segments",a);case 10:case"end":return n.stop()}}),n)})))()},newTrack:function(t,e){t.commit("howl",e)},getWaveform:function(t){return Object(w["a"])(regeneratorRuntime.mark((function e(){var n,r,o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,null!=t.state.buffer){e.next=10;break}return r=new c["Howl"]({src:["example.mp3"],html5:!0,autoplay:!1}),t.dispatch("newTrack",r),e.next=6,fetch("example.mp3").then((function(t){return t.blob()})).then((function(t){return t.arrayBuffer()})).then((function(t){return c["Howler"].ctx.decodeAudioData(t)}));case 6:n=e.sent,t.commit("buffer",n),e.next=11;break;case 10:n=t.state.buffer;case 11:o=[n.getChannelData(0),n.getChannelData(1)],a=new _(T(o[0],100)["avg"]),t.commit("segments",a),e.next=20;break;case 16:e.prev=16,e.t0=e["catch"](0),console.error("failed to retreive audio data"),console.log(e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))()}};function z(){var t={playback:j.STOP,tracks:[],buffer:null,segments:null,loop:[!1,0,0],peaks:[]},e={},n={duration:function(t){return t.tracks[t.tracks.length-1].duration()},seek:function(t){return t.tracks[t.tracks.length-1].seek()},track:function(t){return t.tracks[t.tracks.length-1]}};return{state:t,computed:e,getters:n,actions:M,mutations:$}}var W={render:function(t){return t("div")},props:{width:{type:Number,default:1440},height:{type:Number,default:320},divWidth:{type:Number,default:1440}},data:function(){return{offsetLeft:0,zoom:0,ctx:null,ready:!1,canv:null,loopStart:null,loopEnd:null,dragging:!1,peaksCanv:new Array(this.divWidth)}},created:function(){var t=this;return Object(w["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("getWaveform");case 2:case"end":return e.stop()}}),e)})))()},mounted:function(){var t=this;return Object(w["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=document.getElementById("c"),document.getElementById("scrolltar").addEventListener("scroll",t.onScroll),n.setAttribute("width",t.width),n.setAttribute("height",t.height),t.canv=n,t.ctx=n.getContext("2d");case 6:case"end":return e.stop()}}),e)})))()},computed:{segments:function(){return this.$store.state.segments}},watch:{segments:function(){this.ready||this.draw(),this.ready=!0,this.updatePeaks(),this.updateLoop(),this.zoom=0}},methods:{onScroll:function(t){this.offsetLeft=t.target.scrollLeft,this.updatePeaks(),this.updateLoop()},onZoomIn:function(){this.zoom=Math.min(this.zoom+.1,10),this.updatePeaks(),this.updateLoop()},onZoomOut:function(){this.zoom=Math.max(this.zoom-.1,0),this.updatePeaks(),this.updateLoop()},startSelect:function(){this.$store.dispatch("endLoop"),this.loopStart=null,this.loopEnd=null,this.dragging=!0},endSelect:function(){if(null!=this.loopEnd){this.dragging=!1;var t=this.getTime(this.loopStart),e=this.getTime(this.loopEnd);this.$store.dispatch("startLoop",[t,e])}},selectMove:function(t){this.dragging&&(null==this.loopStart?this.loopStart=t.clientX:(this.loopStart=Math.min(t.clientX,this.loopStart),this.loopEnd=Math.max(t.clientX,this.loopStart)))},updatePeaks:function(){for(var t=this.offsetLeft,e=this.segments,n=e.segmentSize(this.zoom,this.divWidth),r=this.height>>1,o=t;o<t+this.divWidth;o++){var a=e.segmentPeakBottom(o*n,(o+1)*n);this.peaksCanv[o-t]=[r-r*a[0],r-r*a[1]]}},updateLoop:function(){var t=this.$store.state.loop;t[0]&&(this.loopStart=this.getX(t[1]),this.loopEnd=this.getX(t[2]))},getTime:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$store.getters.track.duration();return(t+this.offsetLeft)*e/this.width/(this.zoom+1)},getX:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$store.getters.track.duration();return Math.floor(this.width*t*(this.zoom+1)/e-this.offsetLeft)},drawSlider:function(){if(this.$store.state.playback!=z["STOP"]){var t=this.$store.getters.track.seek(),e=this.getX(t);e>=0&&(this.ctx.beginPath(),this.ctx.lineWidth=1,this.ctx.strokeStyle="black",this.ctx.moveTo(e,0),this.ctx.lineTo(e,this.height),this.ctx.stroke())}},drawSelection:function(){null!=this.loopEnd&&(this.ctx.beginPath(),this.ctx.lineWidth=1,this.ctx.strokeStyle="blue",this.loopEnd>this.loopStart&&(this.ctx.rect(this.loopStart,0,this.loopEnd-this.loopStart,this.height),this.ctx.stroke()))},drawWaveform:function(){var t=this;this.ctx.clearRect(0,0,this.width,this.height),this.ctx.lineWidth=.5,this.ctx.strokeStyle="green",this.ctx.beginPath();var e=0;this.peaksCanv.forEach((function(n){t.ctx.moveTo(e,n[0]),t.ctx.lineTo(e,n[1]),e++})),this.ctx.stroke()},draw:function(){var t=document.getElementById("scroller");t.setAttribute("width",this.width*(this.zoom+1)),t.setAttribute("height",100),this.drawWaveform(),this.drawSlider(),this.drawSelection(),requestAnimationFrame(this.draw.bind(this))}}},R=W,B=Object(h["a"])(R,k,y,!1,null,null,null),C=B.exports;p()(B,{VBtn:d["a"],VIcon:v["a"]});var I={components:{AudioPlayer:b,Waveform:C}},D=I,X=n("7496"),U=Object(h["a"])(D,o,a,!1,null,null,null),V=U.exports;p()(U,{VApp:X["a"]});n("5363");var Y=n("f309");r["a"].use(Y["a"]);var H=new Y["a"]({icons:{iconfont:"mdi"}});r["a"].config.productionTip=!1;var Z=z(),F=new S["a"].Store(Z);new r["a"]({vuetify:H,store:F,render:function(t){return t(V)}}).$mount("#app")}});
//# sourceMappingURL=app.2dacc6f8.js.map